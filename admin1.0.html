<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Sistema de Comanda Digital</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <div class="header">
        <h1>Sistema de Comanda Digital - Panel de Administración</h1>
        <div class="user-info">
            <span id="userRole">Administrador</span>
            <span id="dbStatus" class="db-status connected" title="Base de datos conectada">● BD</span>
            <button class="logout-btn" onclick="logout()">Cerrar Sesión</button>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li class="active" onclick="showSection('dashboard')">Dashboard</li>
                <li onclick="showSection('mesas')">Mesas</li>
                <li onclick="showSection('reportes')">Reportes</li>
                <li onclick="showSection('metricas')">Métricas</li>
                <li onclick="showSection('historial')">Historial de Pedidos</li>
                <li onclick="showSection('ventas')">Ventas del Día</li>
                <li onclick="showSection('menu')">Gestión de Menú</li>
                <li onclick="showSection('usuarios')">Gestión de Usuarios</li>
            </ul>
        </div>
        
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section">
                <h2>Informacion General</h2>
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Ventas Hoy</h3>
                        <div class="card-content">
                            <p class="metric-value">$2,548.50</p>
                            <p class="metric-label">15 pedidos completados</p>
                            <button class="btn-sm" onclick="cargarDatosVentas()">Actualizar</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Pedidos Activos</h3>
                        <div class="card-content">
                            <p class="metric-value">8</p>
                            <p class="metric-label">3 en preparación, 5 pendientes</p>
                            <button class="btn-sm" onclick="cargarPedidosActivos()">Actualizar</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Inventario</h3>
                        <div class="card-content">
                            <p class="metric-value">92%</p>
                            <p class="metric-label">5 productos con stock bajo</p>
                            <button class="btn-sm" onclick="verificarInventario()">Verificar</button>
                        </div>
                    </div>
                </div>
                
                <div class="report-section">
                    <h3>Acciones Rápidas</h3>
                    <button class="btn" onclick="generarReporteDiario()">Generar Reporte Diario</button>
                    <button class="btn" onclick="consultarMetricas()">Consultar Métricas</button>
                    <button class="btn" onclick="cargarHistorial()">Ver Historial</button>
                    <button class="btn" onclick="actualizarVentas()">Actualizar Ventas</button>
                </div>
            </div>
            
            <!--Seccion de reportes-->
            <div id="mesas" class="content-section">
                <h2>Mesas</h2>
                <div class="report">
                    <h3>Selecciona la mesa</h3>
                    <button class="btn" onclick="agregarMesa()">Agregar Mesa</button>
                    <button class="btn" onclick="quitarMesa()">Quitar Mesa</button>
                </div>




            </div>
            
            <!-- Sección de Gestión de Usuarios -->
            <div id="usuarios" class="content-section" style="display:none;">
                <h2>Gestión de Usuarios</h2>
                <div class="report-section">
                    <h3>Usuarios del Sistema</h3>
                    <button class="btn" onclick="cargarUsuarios()">Cargar Usuarios</button>
                    <button class="btn" onclick="mostrarFormularioUsuario()">+ Nuevo Usuario</button>
                    
                    <div id="tablaUsuarios" style="margin-top: 20px;">
                        <p>Los datos de usuarios se cargarán desde la base de datos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userData = null;
        let dbConnection = true; // Simular estado de conexión a BD

        // Simular carga de datos desde BD
        async function cargarDatosIniciales() {
            try {
                // Simular llamada a API/BD
                const datos = await simularConsultaBD('dashboard');
                actualizarUI(datos);
            } catch (error) {
                console.error('Error cargando datos:', error);
                document.getElementById('dbStatus').classList.remove('connected');
                document.getElementById('dbStatus').classList.add('disconnected');
                document.getElementById('dbStatus').title = 'Error de conexión a BD';
            }
        }

        // Funciones para simular consultas a BD (remplazar)
        async function simularConsultaBD(tabla) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const datos = {
                        'dashboard': { ventas: 2548.50, pedidos: 15, inventario: 92 },
                        'usuarios': [
                            { id: 1, usuario: 'admin', rol: 'Administrador', activo: true }
                        ]
                    };
                    resolve(datos[tabla] || {});
                }, 500);
            });
        }

        function actualizarUI(datos) {
            // Aquí se actualizaría la UI con datos reales de BD
            console.log('Datos recibidos:', datos);
        }

        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Mostrar la sección seleccionada
            document.getElementById(sectionId).style.display = 'block';
            
            // Actualizar menú activo
            document.querySelectorAll('.sidebar-menu li').forEach(item => {
                item.classList.remove('active');
            });
            
            // Encontrar y activar el elemento del menú correspondiente
            const menuItems = document.querySelectorAll('.sidebar-menu li');
            for (let item of menuItems) {
                if (item.textContent.toLowerCase().includes(sectionId)) {
                    item.classList.add('active');
                    break;
                }
            }

            // Cargar datos específicos de la sección
            if (sectionId === 'usuarios') {
                cargarUsuarios();
            }
        }

        function cargarUsuarios() {
            // Simular carga de usuarios desde BD
            simularConsultaBD('usuarios').then(usuarios => {
                const tabla = document.getElementById('tablaUsuarios');
                tabla.innerHTML = `
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Usuario</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Rol</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Estado</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${usuarios.map(user => `
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${user.id}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${user.usuario}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${user.rol}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${user.activo ? 'Activo' : 'Inactivo'}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">
                                        <button class="btn-sm">Editar</button>
                                        <button class="btn-sm btn-danger">Eliminar</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            });
        }

        function logout() {
            if (confirm('¿Está seguro que desea cerrar sesión?')) {
                // Aquí se podría limpiar la sesión en el backend
                window.location.href = 'login.html';
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosIniciales();
            
            // Simular verificación periódica de conexión a BD
            setInterval(() => {
                dbConnection = Math.random() > 0.1; // 90% de tiempo conectado
                const statusElement = document.getElementById('dbStatus');
                if (dbConnection) {
                    statusElement.classList.remove('disconnected');
                    statusElement.classList.add('connected');
                    statusElement.title = 'Base de datos conectada';
                } else {
                    statusElement.classList.remove('connected');
                    statusElement.classList.add('disconnected');
                    statusElement.title = 'Error de conexión a BD';
                }
            }, 10000);
        });
    </script>
</body>
</html>